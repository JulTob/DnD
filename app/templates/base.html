<!DOCTYPE html>
<html lang="en">
<head>
	<script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>

	{% include 'head.html' %}
	<title>{% block title %}D&D Generators{% endblock %}</title>
	{% block head %}{% endblock %}
	</head>

<body>

<!-- Loader overlay -->
<div id="loader">
  <div class="sol-layer"></div> <!-- The sun -->
  <div class="orbit-layer orbit1">
    <div class="planet"></div>
    <div class="planet"></div>
    <div class="planet"></div>
  </div>
  <div class="orbit-layer orbit2">
    <div class="planet"></div>
    <div class="planet"></div>
    <div class="planet"></div>
    <div class="planet"></div>
  </div>
  <div class="orbit-layer orbit3">
    <div class="planet"></div>
    <div class="planet"></div>
    <div class="planet"></div>
	<div class="planet"></div>
    <div class="planet"></div>

  </div>
</div>

	<div id="FullPage">
			{% include 'header.html' %}
			<div class="container">
					{% block content %}
					{% endblock %}
					</div>
			</div>

	{% include 'footer.html' %}

	{% block scripts %}
	{% endblock %}

<script>
const loader   = document.getElementById('loader');
const fullPage = document.getElementById('FullPage');   // your main wrapper

function populatePlanets () {
  document.querySelector('.sol-layer').textContent = randomFrom(solSymbols);

  document.querySelectorAll('.orbit-layer').forEach((orbit, i) => {
    orbit.innerHTML = '';                 // purge old planets
    const count = i + 4;
    const r = orbit.offsetWidth / 2;      // now non-zero
    for (let j = 0; j < count; j++) {
      const ang =  360 * j / count;
      const p   = document.createElement('div');
      p.className = 'planet';
      p.textContent = randomFrom(planetSymbols);
      p.style.transform = `rotate(${ang}deg) translate(${r}px)`;
      orbit.appendChild(p);
    }
  });
}

function showLoader() {
  loader.classList.add('show');
  // Optionally dim the page behind:
  fullPage.style.filter = 'blur(2px)';
	requestAnimationFrame(populatePlanets);  // then build planets

}

function hideLoader() {
  loader.classList.remove('show');
  fullPage.style.filter = 'none';
}

/* 1. Hide it once the initial HTML is fully painted */
window.addEventListener('load', hideLoader);

/* 2. Show it whenever a <form> is submitted */
document.querySelectorAll('form')
  .forEach(f => f.addEventListener('submit', showLoader));

/* 3. Show it for JS-driven navigation buttons or links */
document.querySelectorAll('[data-show-loader]')
  .forEach(el => el.addEventListener('click', showLoader));

/* 4. Wrap fetch / AJAX calls */
async function fetchWithLoader(url, opts) {
  try {
    showLoader();
    return await fetch(url, opts);
  } finally {
    hideLoader();
  }
}

/* EXAMPLE use inside your NPC generator:
   const res = await fetchWithLoader('/api/new-npc');  */
</script>
<script>


const solSymbols = [
	'âš›','âŽˆ','ð–§µ','ð“‡¬','ðŸœ¹','ð–£Š','ð–¥ ',
	 'ð–£“','ÖŽ','Ö','ð–£','âŒ˜',
	'ÖŽ','Ö', 'â˜‰','âœï¸Ž','âœ ','â˜©','â™°','â™±','â˜“','âšœï¸Ž',
	'â—‡','â—ˆ','â˜¿','â™€','â™‚','âš³','âš·','âšµ','â›¦','âš','â­‘','â˜†','âœ§','â‰','â„','â…','â†',
	'âœ¡','âŸ','â­’','âœ©','âœ¯','â›¤','â›§','â›¥','Ûž','ðŸœ',
    'âŒ­','â§²','â€»','â˜¯','à¿Š','à¿‹','à¿Œ','â˜®',"â—¯",'âŽŠ','â','â„','â€','âƒ','â‚','â…',
	 'ð“Œ–', 'ðŸœ','â˜ ','â˜£','âš–','âš›','âŽˆ','â˜¸','ð‘','âš™ï¸Ž',
	'âœ¦','â—‹','â˜‰', 'â›§','âœ¶','â­’','âœ©','âœ¯','â›¤','â›§','â›¥',
'â›¦','âš','â™','â˜…','â˜ ','ðŸœ','â˜¯','âš','â˜‰','â˜£','âš–','âš›','âŽˆ','â˜¸','ð‘','âš™ï¸Ž','â˜¯','à¿Š','à¿‹','à¿Œ',
	'âŠ™','âœ¹','âŠ™','âœ¹',,'â˜…','â˜†','â›¤','â›§','âš˜','â˜¥','â™†','âœ¡','âš•','â˜¯','âš›',
'â£','â¬ ','â¬¡','à¼“', 'â˜¸','ð‘','âš™ï¸Ž','â˜¯','à¿Š','à¿‹','à¿Œ',];
const orbitSymbols = [''];
const planetSymbols = [
   'áš ','áš¡','áš¢','áš£','áš¤','áš¥',
  'áš¦','áš§','áš¨','áš©','ášª','ášµ','áš´','áš³','áš²','áš±',
  'áš°','áš¯','áš®','áš­','áš¬','áš«','áš¶','áš·','áš¸','áš¹','ášº',
  'áš»','áš¼','áš½','áš¾','áš¿','á›€','á›‹','á›Š','á›‰','á›ˆ',
  'á›‡','á›†','á›…','á›„','á›ƒ','á›‚','á›','á›Œ','á›','á›Ž',
  'á›','á›','á›‘','á›’','á›“','á›”','á›•','á›–','á›¡','á› ','á›Ÿ',
  'á›ž','á›','á›œ','á››','á›š','á›™','á›˜','á›—','á›¢',
  'á›£','á›¤','á›¥','á›¦','á›§','á›¨','á›©','á›ª','á›«','á›¬',
  'á›­','á›®','á›¯','á›°',
 	'â˜¿','â™€','â™‚','âš³','âš·','âšµ','â›¦','âš','â­‘','â˜†','âœ§','â‰','â„','â…','â†',
	'âœ¡','âŸ','â­’','âœ©','âœ¯','â›¤','â›§','â›¥','Ûž','ðŸœ',
	 'ð“Œ–', 'ðŸœ','â˜ ','â˜£','âš–','âš›','âŽˆ','â˜¸','ð‘','âš™ï¸Ž',
	'âœ¦', 'â›§','âœ¶','â­’','âœ©','âœ¯','â›¤','â›§','â›¥',
'â›¦','âš','â™','â˜…','â˜ ','ðŸœ','â˜¯','âš','â˜£','âš–',
	'ðŸœš','â˜…','â˜†','â›¤','â›§','âš˜','â˜¥','â™†','âœ¡','âš•','â˜¯','âš›',
	'áš ','á›ž','á›‰','â˜¿','â™€','â™‚','âš³','âš·','âšµ',
'ðŸœ','âŒ­','â§²','â™”','â™•','â™–','â™—','ð–£“',	'â˜¯', 'ðŸœ','âŒ­','â§²','â™”','â™•','â™–','â™—',
  'â™™','âšš','â˜¤','â€»','âš•','â˜¥', 'â™”','â™•','â™–','â™—','â™™','âšš','â˜¤',
  'âš•','â˜¥',
  'â˜¢','â˜˜','ð“‚€','á¯¼','à¿„',
  'â˜¬','â˜«','Û','Û©','ØŽ','â§','ðŸž','ðŸŸ',
  'Î¨','â„œ','â³©','Î©','â„¦','â„§','ðƒ¢','ðƒ¯','â™§','â™¡','â™¢','â™¤',
  'ð“„€','ð“†—','ð“†™','ð“†š','ð¦','à¿“','à¿”','à¼„','à¼…','à¼†','à¼»','à¼º',
  'â›©','â™¨','ð‚¡','ðŠ','ð€¼','âš•ï¸Ž','â›»','ðŸ¤','ðŸª','ðŸœ¾','ðŸ','ðŸœ±','ð›€','Æ±',
  'â²','âš³','âš´','âšµ','âš¶','âš¸','â™†','â™…','â™„','â™ƒ','â™','â˜¿','ðŸœ¯','ðŸœ©','ðŸœ¦',
  'ðŸœ¥','ðŸœ£','â›¢','ð“¢','ð–‹','âœï¸Ž','âœ ','â˜©','â™°','â™±','â˜“','âšœï¸Ž',
  'â€','âœ¿','â¦','âš','Î˜','ÏŸ',
  'áš ','áš¡','áš£','á›ƒ','á›„','á›†','á›ˆ','á›‰','á›•','á›–','á›—','á›˜','á›™','á›ª',
  'á›©','á›¨','á›¦','á›¥','á›¤','á›£','á›¢','á›¡','á›Ÿ','á›ž','á›','á›œ','á›°',
  'á›¯','á›®','á›­','á›¬','á›«','âšŠ','âš‹','âšŒ','âš','âšŽ','âš','ðŒ€','ðŒ','ðŒ‚',
  'ðŒƒ','ðŒ„','ðŒ…','â˜°','â˜±','â˜²','â˜³','â˜´','â˜µ','â˜¶','â˜·',
  'à¼€','à¼','à¼‚','à¼ƒ','à¼„','à¼…','à¼†','à¼‡','à¼Š','à¼’',,'à¼”','à¼—',


];

  function randomFrom(arr) {
    return arr[Math.floor(Math.random() * arr.length)];
  }

  // Set Sol symbol
  document.querySelector('.sol-layer').textContent = randomFrom(solSymbols);

  // For each orbit ring
  document.querySelectorAll('.orbit-layer').forEach((orbit, i) => {
    const count = i + 1;  // 1, 2, 3
    for (let j = 0; j < count; j++) {
      const angle = (360 / count) * j;
      const r = orbit.offsetWidth / 2;
      const planet = document.createElement('div');
      planet.classList.add('planet');
      planet.textContent = randomFrom(planetSymbols);
      planet.style.transform = `rotate(${angle}deg) translate(${r}px)`;
      orbit.appendChild(planet);
    }
  });
</script>
</body>
</html>
